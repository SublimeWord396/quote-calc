<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Driveway Quote Calculator</title>
  <meta name="theme-color" content="#0b0b0d" />
  <style>
    :root { font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    body { margin: 0; background: #0b0b0d; color: #f2f2f2; }
    header { padding: 16px; position: sticky; top: 0; background: #0b0b0d; border-bottom: 1px solid #222; }
    h1 { font-size: 18px; margin: 0 0 4px; }
    .sub { font-size: 12px; opacity: 0.75; margin: 0; }
    .wrap { padding: 16px; max-width: 760px; margin: 0 auto; }
    .card { background: #121217; border: 1px solid #23232a; border-radius: 14px; padding: 14px; margin-bottom: 14px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display: block; font-size: 12px; opacity: 0.8; margin-bottom: 6px; }
    input, select, textarea, button {
      width: 100%; box-sizing: border-box;
      background: #0f0f14; color: #f2f2f2;
      border: 1px solid #2a2a33; border-radius: 12px;
      padding: 12px; font-size: 16px;
    }
    textarea { min-height: 88px; resize: vertical; }
    .pill { display: inline-flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .pill .chk { display: inline-flex; align-items: center; gap: 8px; background: #0f0f14; border: 1px solid #2a2a33; padding: 10px 12px; border-radius: 999px; }
    .pill input[type="checkbox"] { width: 18px; height: 18px; }
    .result { font-size: 26px; font-weight: 800; letter-spacing: 0.2px; }
    .muted { opacity: 0.75; font-size: 12px; line-height: 1.4; white-space: pre-line; }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    button { cursor: pointer; font-weight: 700; }
    .primary { background: #1c4cff; border-color: #1c4cff; }
    .ghost { background: #0f0f14; }
    .small { font-size: 12px; opacity: 0.75; margin-top: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .presets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
    .presetBtn { padding: 10px; border-radius: 12px; font-size: 13px; }
    @media (max-width: 560px) {
      .grid { grid-template-columns: 1fr; }
      .presets { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
<header>
  <h1>Driveway Quote Calculator</h1>
  <p class="sub">Labor quote = (hours × base rate) + adders + buffer → rounded up</p>
</header>

<div class="wrap">

  <div class="card">
    <label>Quick presets (tap to fill hours + adders)</label>
    <div class="presets">
      <button class="presetBtn ghost" data-preset="oil">Oil change</button>
      <button class="presetBtn ghost" data-preset="vcg">Valve cover gasket</button>
      <button class="presetBtn ghost" data-preset="thermo">Thermostat</button>
      <button class="presetBtn ghost" data-preset="pump">External water pump</button>
    </div>
    <div class="small">Presets are just starting points — adjust for the car.</div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <label>Job name</label>
        <input id="jobName" placeholder="e.g., Valve cover gasket" />
      </div>
      <div>
        <label>Estimated hours</label>
        <input id="hours" type="number" inputmode="decimal" min="0" step="0.25" value="2.5" />
      </div>

      <div>
        <label>Base rate ($/hr equivalent)</label>
        <input id="rate" type="number" inputmode="decimal" min="0" step="5" value="90" />
      </div>
      <div>
        <label>Buffer (covers broken bolts, extra steps)</label>
        <select id="buffer">
          <option value="0.15">15%</option>
          <option value="0.20" selected>20%</option>
          <option value="0.25">25%</option>
          <option value="0.30">30%</option>
        </select>
      </div>

      <div>
        <label>Round up to nearest</label>
        <select id="roundTo">
          <option value="10">$10</option>
          <option value="25">$25</option>
          <option value="50" selected>$50</option>
          <option value="100">$100</option>
        </select>
      </div>
      <div>
        <label>Minimum labor (won’t quote below)</label>
        <input id="minimum" type="number" inputmode="numeric" min="0" step="25" value="150" />
      </div>
    </div>

    <div class="pill" style="margin-top:14px;">
      <div class="chk"><input id="tight" type="checkbox" checked><label for="tight">Tight bay (+$50)</label></div>
      <div class="chk"><input id="v6v8" type="checkbox"><label for="v6v8">V6/V8 (+$50)</label></div>
      <div class="chk"><input id="german" type="checkbox"><label for="german">German/Luxury (+$75)</label></div>
      <div class="chk"><input id="rust" type="checkbox"><label for="rust">Rust risk (+$75)</label></div>
      <div class="chk"><input id="bleed" type="checkbox"><label for="bleed">Bleeding/extra procedure (+$35)</label></div>
      <div class="chk"><input id="special" type="checkbox"><label for="special">Special access/tools (+$50)</label></div>
    </div>

    <div class="grid" style="margin-top:12px;">
      <div>
        <label>Custom add-on ($)</label>
        <input id="customAddon" type="number" inputmode="numeric" min="0" step="5" value="0" />
      </div>
      <div>
        <label>Notes (optional)</label>
        <input id="notes" placeholder="e.g., customer supplies parts" />
      </div>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <label>Recommended labor quote</label>
        <div class="result" id="final">$0</div>
        <div class="muted" id="breakdown"></div>
      </div>
      <div>
        <label>Customer text (copy/paste)</label>
        <textarea id="textOut" class="mono" readonly></textarea>
        <div class="btns">
          <button class="primary" id="copyBtn">Copy</button>
          <button class="ghost" id="saveBtn">Save defaults</button>
        </div>
        <div class="btns">
          <button class="ghost" id="loadBtn">Load saved</button>
          <button class="ghost" id="resetBtn">Reset</button>
        </div>
        <div class="small">Tip: use “recommend” language; don’t guarantee a fix.</div>
      </div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  function roundUpTo(x, step) { return Math.ceil(x / step) * step; }
  function money(n) { return "$" + (Math.round(n)).toString(); }

  function currentState() {
    return {
      jobName: $("jobName").value,
      hours: $("hours").value,
      rate: $("rate").value,
      buffer: $("buffer").value,
      roundTo: $("roundTo").value,
      minimum: $("minimum").value,
      tight: $("tight").checked,
      v6v8: $("v6v8").checked,
      german: $("german").checked,
      rust: $("rust").checked,
      bleed: $("bleed").checked,
      special: $("special").checked,
      customAddon: $("customAddon").value,
      notes: $("notes").value
    };
  }

  function applyState(s) {
    if (!s) return;
    $("jobName").value = s.jobName ?? "";
    $("hours").value = s.hours ?? 2.5;
    $("rate").value = s.rate ?? 90;
    $("buffer").value = s.buffer ?? 0.20;
    $("roundTo").value = s.roundTo ?? 50;
    $("minimum").value = s.minimum ?? 150;
    $("tight").checked = !!s.tight;
    $("v6v8").checked = !!s.v6v8;
    $("german").checked = !!s.german;
    $("rust").checked = !!s.rust;
    $("bleed").checked = !!s.bleed;
    $("special").checked = !!s.special;
    $("customAddon").value = s.customAddon ?? 0;
    $("notes").value = s.notes ?? "";
  }

  function calc() {
    const jobName = $("jobName").value.trim();
    const hours = parseFloat($("hours").value || "0");
    const rate = parseFloat($("rate").value || "0");
    const buffer = parseFloat($("buffer").value || "0");
    const roundTo = parseFloat($("roundTo").value || "50");
    const minimum = parseFloat($("minimum").value || "0");

    let adders = 0;
    if ($("tight").checked) adders += 50;
    if ($("v6v8").checked) adders += 50;
    if ($("german").checked) adders += 75;
    if ($("rust").checked) adders += 75;
    if ($("bleed").checked) adders += 35;
    if ($("special").checked) adders += 50;

    const customAddon = parseFloat($("customAddon").value || "0");
    adders += customAddon;

    const base = hours * rate;
    const subtotal = base + adders;
    const buffered = subtotal * (1 + buffer);
    const final = roundUpTo(Math.max(buffered, minimum), roundTo);

    $("final").textContent = money(final);

    $("breakdown").textContent =
      `Base: ${hours.toFixed(2)} hrs × ${money(rate)}/hr = ${money(base)}\n` +
      `Adders: ${money(adders)}\n` +
      `Subtotal: ${money(subtotal)}\n` +
      `Buffer: ${(buffer*100).toFixed(0)}% → ${money(buffered)}\n` +
      `Rounded up to ${money(roundTo)} (min ${money(minimum)})`;

    const notes = $("notes").value.trim();
    const line1 = jobName ? `Job: ${jobName}` : `Job: (describe service)`;
    const msg =
`${line1}
Labor: ${money(final)}
Parts: customer supplies parts unless agreed otherwise.
Notes: ${notes || "(optional)"}
Reply YES to confirm scope + price.`;

    $("textOut").value = msg;
  }

  function resetAll() {
    applyState({jobName:"",hours:2.5,rate:90,buffer:0.20,roundTo:50,minimum:150,tight:true,v6v8:false,german:false,rust:false,bleed:false,special:false,customAddon:0,notes:""});
    calc();
  }

  const presets = {
    oil:   { jobName:"Oil change", hours:0.6, tight:false, v6v8:false, german:false, rust:false, bleed:false, special:false, customAddon:0 },
    vcg:   { jobName:"Valve cover gasket", hours:3.0, tight:true, v6v8:true, german:false, rust:false, bleed:false, special:true, customAddon:0 },
    thermo:{ jobName:"Thermostat replacement", hours:1.8, tight:true, v6v8:false, german:false, rust:false, bleed:true, special:false, customAddon:0 },
    pump:  { jobName:"External water pump", hours:3.2, tight:true, v6v8:false, german:false, rust:false, bleed:true, special:true, customAddon:0 }
  };

  document.querySelectorAll("[data-preset]").forEach(btn => {
    btn.addEventListener("click", () => {
      const key = btn.getAttribute("data-preset");
      const p = presets[key];
      applyState(Object.assign(currentState(), p));
      calc();
    });
  });

  ["jobName","hours","rate","buffer","roundTo","minimum","tight","v6v8","german","rust","bleed","special","customAddon","notes"]
    .forEach(id => $(id).addEventListener("input", calc));

  $("copyBtn").addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText($("textOut").value);
      $("copyBtn").textContent = "Copied!";
      setTimeout(() => $("copyBtn").textContent = "Copy", 900);
    } catch (e) {
      alert("Copy failed. Select the text and copy manually.");
    }
  });

  $("saveBtn").addEventListener("click", () => {
    const s = currentState();
    const defaults = Object.assign({}, s, {jobName:"", notes:""});
    localStorage.setItem("dq_defaults_v1", JSON.stringify(defaults));
    $("saveBtn").textContent = "Saved!";
    setTimeout(() => $("saveBtn").textContent = "Save defaults", 900);
  });

  $("loadBtn").addEventListener("click", () => {
    const raw = localStorage.getItem("dq_defaults_v1");
    if (!raw) { alert("No saved defaults yet."); return; }
    const d = JSON.parse(raw);
    applyState(Object.assign(currentState(), d));
    calc();
  });

  $("resetBtn").addEventListener("click", resetAll);

  resetAll();
</script>
</body>
</html>
